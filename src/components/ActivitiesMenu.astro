---
// Builds a dropdown list of links from files in /src/pages/activities/**.
// Usage: <ActivitiesMenu label="Activities" />
interface Item { url: string; label: string }

const { label = 'Activities' } = Astro.props as { label?: string };

// Eagerly import all activity pages; works for .astro, .md, .mdx
const modules = import.meta.glob('../pages/activities/**/*.{astro,md,mdx}', { eager: true });

const startCase = (s: string) => s
  .replace(/[-_]/g, ' ')
  .split(' ')
  .map((w) => (w ? w[0].toUpperCase() + w.slice(1) : w))
  .join(' ');

function toRoute(file: string) {
  let p = file;
  const idx = p.lastIndexOf('/pages');
  if (idx !== -1) p = p.slice(idx + 6);
  const dot = p.lastIndexOf('.');
  if (dot !== -1) p = p.slice(0, dot);
  if (p.endsWith('/index')) p = p.slice(0, -('/index'.length)) + '/';
  return p;
}

const toLabelFromRoute = (route: string) => {
  const parts = route.split('/').filter(Boolean);
  const last = parts[parts.length - 1] ?? 'Activities';
  return startCase(last);
};

const items: Item[] = Object.entries(modules)
  .map(([file, mod]: any) => {
    const url = toRoute(file);
    const label = mod?.frontmatter?.title || mod?.title || toLabelFromRoute(url);
    return { url, label } as Item;
  })
  // hide the top-level /activities/ index in the dropdown (optional)
  .filter((it) => it.url !== '/activities/')
  .sort((a, b) => a.label.localeCompare(b.label));
---
<nav class="relative" aria-label="Activities">
  <details class="group inline-block relative">
    <summary class="flex items-center gap-1 list-none cursor-pointer select-none px-3 py-2 border border-ink rounded-md font-semibold bg-white hover:bg-soft focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand">
      {label}
      <svg
        class="w-3 h-3 transition-transform group-open:rotate-180"
        viewBox="0 0 10 6"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true">
        <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </summary>
    <ul class="absolute right-0 mt-2 p-2 border border-soft bg-white rounded-xl min-w-[14rem] shadow-lg z-10">
      {items.map((it) => (
        <li class="list-none">
          <a
            class="block px-3 py-2 no-underline text-inherit rounded-md hover:bg-soft focus:bg-soft outline-none"
            href={it.url}
            >{it.label}</a
          >
        </li>
      ))}
    </ul>
  </details>
</nav>
